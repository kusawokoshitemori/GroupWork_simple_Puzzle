<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é‡å­äº”ç›®ä¸¦ã¹</title>
    <link rel="stylesheet" href="css/simple_puzzle.css">
    <script defer src="css/simple_puzzle.js"></script>
</head>
<body>
    <div id="title-container">
        <h1>é‡å­äº”ç›®ä¸¦ã¹</h1>
        <button id="infoButton" title="ãƒ«ãƒ¼ãƒ«èª¬æ˜" onclick="showRulesPopup()">i</button> <!-- titleå±æ€§ã‚’è¿½åŠ  -->
    </div>
    <!--ç›¤é¢ã‚’è¡¨ç¤º-->
  <div id="game-container">
    <div id="board"></div>
    <div id="copy_board"></div>
    <div id="right-container">
      <button id="observation" onclick="observation()">è¦³æ¸¬ã™ã‚‹ğŸ‘€</button>
      <button id="no_observation" onclick="no_observation()">è¦³æ¸¬ã—ãªã„ğŸ™ˆ</button>
      <button id="switchBoard" onclick="switchBoard()">ç¢ºç‡ã®ç›¤é¢ã¸</button>
      <button id="resetGame" onclick="resetGame()">Reset Game</button>
      <!--æ®‹ã‚Šã®è¦³æ¸¬å›æ•°ã®è¡¨ç¤º-->
      <p id="blackObservations">ãŸã‚ã†ã•ã‚“ã®æ®‹ã‚Šè¦³æ¸¬å›æ•°: 3</p>
      <p id="whiteObservations">ã¯ãªã“ã•ã‚“ã®æ®‹ã‚Šè¦³æ¸¬å›æ•°: 3</p>
      <p id="turnDisplay">ã‚¿ãƒ¼ãƒ³æ•°: <span id="turnNumber">1</span></p>
      <div id="timer"></div>
    </div>
  </div>
  <!--messageã¯ã€é »ç¹ã«é•·ã•ãŒå¤‰ã‚ã‚‹ã®ã§ç›¤é¢ä¸‹ã¸ã€‚-->
  <p id="message"></p>
  <div class="footerFrame">
    é‡å­äº”ç›®ä¸¦ã¹ created by Hiroaki Yamazaki, Kyotaro Nakata, Shota Sasaki, and Shota Shishido of Team 6.
  </div>

    <!-- ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã¨ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ— -->
    <div id="overlay" class="overlay"></div>
    <div id="popup" class="popup">
        <h2>ãƒ«ãƒ¼ãƒ«èª¬æ˜</h2>
        <p>1. åŸºæœ¬ãƒ«ãƒ¼ãƒ«:<br>
          - é€šå¸¸ã®äº”ç›®ä¸¦ã¹ã¨åŒã˜ã‚ˆã†ã«ã€ç¸¦ãƒ»æ¨ªãƒ»æ–œã‚ã«åŒã˜è‰²ã®çŸ³ã‚’5ã¤ä¸¦ã¹ã‚‹ã“ã¨ã‚’ç›®æŒ‡ã—ã¾ã™ã€‚</p>
      <p>2. é‡å­ã®è¦ç´ :<br>
          - ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒç½®ãçŸ³ã¯ç¢ºå®šã—ãŸè‰²ã§ã¯ãªãã€ç¢ºç‡çš„ã«é»’ã¾ãŸã¯ç™½ã«ãªã‚‹ã€Œé‡å­çŸ³ã€ã¨ãªã£ã¦ã„ã¾ã™ã€‚<br>
          - ä¾‹ãˆã°ã€é»’ãŒ90%ã®ç¢ºç‡ã§å‡ºç¾ã—ã€ç™½ãŒ10%ã®ç¢ºç‡ã§å‡ºç¾ã™ã‚‹çŸ³ã‚„ã€ãã®é€†ã®çŸ³ãªã©ãŒå­˜åœ¨ã—ã¾ã™ã€‚</p>
      <p>3. è¦³æ¸¬:<br>
          - ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¯è‡ªåˆ†ã®ã‚¿ãƒ¼ãƒ³ã§çŸ³ã‚’ç½®ã„ãŸå¾Œã«ã€ãã®çŸ³ã‚’ã€Œè¦³æ¸¬ã€ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚<br>
          - è¦³æ¸¬ã‚’è¡Œã†ã¨ã€ç›¤é¢ã®çŸ³ã®è‰²ãŒç¢ºå®šã—ã¾ã™ã€‚<br>
          <mark>- è¦³æ¸¬ã™ã‚‹ã‹ã©ã†ã‹ã‚’é¸æŠã—ãªã‘ã‚Œã°ã€æ¬¡ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¯çŸ³ã‚’ç½®ãã“ã¨ãŒã§ãã¾ã›ã‚“ã€‚</mark></p>
      <p>4. å‹åˆ©æ¡ä»¶:<br>
          - è¦³æ¸¬ã‚’è¡Œã£ãŸçµæœã€ç¸¦ãƒ»æ¨ªãƒ»æ–œã‚ã«åŒã˜è‰²ã®çŸ³ãŒ5ã¤ä¸¦ã‚“ã å ´åˆã€ãã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®å‹åˆ©ã¨ãªã‚Šã¾ã™ã€‚<br>
          - å„ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¯è¦³æ¸¬ã‚’è¡Œãˆã‚‹å›æ•°ã«åˆ¶é™ãŒã‚ã‚Šã¾ã™ã€‚ä¾‹ãˆã°ã€è¦³æ¸¬ã‚’è¡Œãˆã‚‹å›æ•°ãŒ3å›ã¾ã§ã¨è¨­å®šã•ã‚Œã¦ã„ã‚‹å ´åˆã€ãã‚Œã‚’è¶…ãˆã‚‹è¦³æ¸¬ã¯è¡Œãˆã¾ã›ã‚“ã€‚<br>
          - ã‚‚ã—ã€åŒæ–¹ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒè¦³æ¸¬ã‚’è¡Œã„ãã£ã¦ã‚‚5ç›®ãŒæƒã‚ãªã‹ã£ãŸå ´åˆã€å¼•ãåˆ†ã‘ã¨ãªã‚Šã¾ã™ã€‚</p>
        <button onclick="closeRulesPopup()">é–‰ã˜ã‚‹</button>
    </div>

    <!-- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼åã®å…¥åŠ›ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ— -->
    <div id="userInputPopup" class="popup">
        <h2>ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼åã¨è¦³æ¸¬å›æ•°ã®è¨­å®š</h2>
        <p>ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„:</p>
        <label for="blackPlayer">å…ˆæ”»(é»’):</label>
        <input type="text" id="blackPlayerInput" value="ãŸã‚ã†"><br>
        <label for="whitePlayer">å¾Œæ”»(ç™½):</label>
        <input type="text" id="whitePlayerInput" value="ã¯ãªã“"><br>
        <p>è¦³æ¸¬å›æ•°ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„:</p>
        <input type="number" id="observationsInput" value="3" min="1" step="1"><br>
        <p>æ™‚é–“åˆ¶é™ã‚’è¨­å®šã—ã¦ãã ã•ã„:</p>
        <select id="timeLimit">
          <option value="0">åˆ¶é™ãªã—</option>
          <option value="15">15ç§’</option>
          <option value="30">30ç§’</option>
          <option value="60">60ç§’</option>
        </select>
        <button onclick="submitUserInputs()">OK</button>
        <button id = "cancel_reset" onclick="closeUserInput()">Cancel Reset</button>
    </div>
    <script src="js/simple_puzzle.js"></script>
    <script>
      let rulesPopupCloseCount = 0; // ãƒ«ãƒ¼ãƒ«èª¬æ˜ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ãŒé–‰ã˜ã‚‰ã‚ŒãŸå›æ•°ã‚’ã‚«ã‚¦ãƒ³ãƒˆã™ã‚‹å¤‰æ•°

      // åˆå›ãƒ­ãƒ¼ãƒ‰æ™‚ã«ãƒ«ãƒ¼ãƒ«èª¬æ˜ã¨ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ã®ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’è¡¨ç¤ºã™ã‚‹
      window.onload = function() {
        rulesPopupCloseCount = 0; // åˆæœŸå€¤ã¨ã—ã¦0ã‚’è¨­å®š
        showPopup(true);
      };

      // ã‚¤ãƒ³ãƒ•ã‚©ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ãŸã¨ãã«ãƒ«ãƒ¼ãƒ«èª¬æ˜ã®ã¿ã‚’è¡¨ç¤ºã™ã‚‹é–¢æ•°
      function showRulesPopup() {
        document.getElementById('overlay').style.display = 'block';
        document.getElementById('popup').style.display = 'block';
        document.getElementById('userInputPopup').style.display = 'none';
        rulesPopupCloseCount += 1; // å¤‰æ•°ã«1ã‚’è¶³ã™
        console.log('Rules popup closed count:', rulesPopupCloseCount); // ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«è¡¨ç¤º
      }

      // ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’è¡¨ç¤ºã™ã‚‹é–¢æ•°ã€‚initialãŒtrueãªã‚‰åˆå›è¡¨ç¤ºç”¨
      function showPopup(initial) {
        document.getElementById('overlay').style.display = 'block';
        document.getElementById('popup').style.display = 'block';
        document.getElementById("cancel_reset").disabled = true;
        if (initial) {
          document.getElementById('userInputPopup').style.display = 'none';
        }
      }

      // ãƒ«ãƒ¼ãƒ«èª¬æ˜ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’é–‰ã˜ã¦ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’è¡¨ç¤ºã™ã‚‹é–¢æ•°
      function closeRulesPopup() {
        document.getElementById('popup').style.display = 'none';
        rulesPopupCloseCount += 1; // å¤‰æ•°ã«1ã‚’è¶³ã™
        if (rulesPopupCloseCount === 1) {
          document.getElementById('userInputPopup').style.display = 'block';
        }
        else {
          document.getElementById('overlay').style.display = 'none';
        }
        console.log('Rules popup closed count:', rulesPopupCloseCount); // ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«è¡¨ç¤º
      }

      // ã™ã¹ã¦ã®ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’é–‰ã˜ã‚‹é–¢æ•°
      function closePopup() {
        document.getElementById('overlay').style.display = 'none';
        document.getElementById('popup').style.display = 'none';
        document.getElementById('userInputPopup').style.display = 'none';
      }
      
      // ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ç”»é¢ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã™ã‚‹é–¢æ•°
      function closeUserInput() {
        document.getElementById('overlay').style.display = 'none';
        document.getElementById('userInputPopup').style.display = 'none';
      }
      // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼åã®å…¥åŠ›ã‚’å–å¾—ã—ã¦ã‚²ãƒ¼ãƒ ã‚’é–‹å§‹ã™ã‚‹é–¢æ•°
      function submitUserInputs() {
        console.log("submitUserInputs function called");
        currentPlayerIndex = 0;
        const blackPlayerInput = document.getElementById('blackPlayerInput').value;
        const whitePlayerInput = document.getElementById('whitePlayerInput').value;
        const observationsInput = document.getElementById('observationsInput').value;
        const timeLimitSelect = document.getElementById('timeLimit');

        // ç©ºæ¬„ãƒã‚§ãƒƒã‚¯
        if (blackPlayerInput === "" || whitePlayerInput === "") {
            alert("ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");
            return;
        }
        const observations = Number(observationsInput);
        // è¦³æ¸¬å›æ•°ã®å…¥åŠ›å€¤ãƒã‚§ãƒƒã‚¯
        if (isNaN(observations) || observations < 1 || !Number.isInteger(observations)) {
            alert("è¦³æ¸¬å›æ•°ã¯1ä»¥ä¸Šã®æ•´æ•°ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");
            return;
        }

        blackPlayer = blackPlayerInput;
        whitePlayer = whitePlayerInput;
        blackObservations = observationsInput;
        whiteObservations = observationsInput;

        // æ™‚é–“åˆ¶é™ã®è¨­å®š
        isObservationOnly = false;
        timeLimit = parseInt(timeLimitSelect.value);
        timeRemaining = timeLimit;
        updateTimerDisplay();
        if (timeLimit > 0) {
          startTimer();
        }

        updateObservationCount();
        closePopup();
        createBoard(); // ç›¤é¢ã‚’ä½œæˆã™ã‚‹
        currentPlayer = blackPlayer;
        waitingPlayer = whitePlayer;
        messageElement.textContent = `${currentPlayer} ã•ã‚“ã®ç•ªã§ã™ã€‚ï¼ˆæŒã¡é§’ï¼š${players[currentPlayerIndex]}ï¼‰`;
        // ä»¥ä¸‹ã¯ã€å…ƒã€…resetGame()ã®æ©Ÿèƒ½ã ã£ãŸã‚‚ã®ã‚’ç§»è­²ã—ã¦ããŸã€‚
        document.getElementById("switchBoard").textContent = "ç¢ºç‡ã®ç›¤é¢ã¸";
        isEnd = false;
        turnCount = 1;
        playerActionCount = 0;
        updateTurnDisplay();
      }
    </script>
</body>
</html>
